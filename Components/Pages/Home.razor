@page "/"
@using Test.Data // Add this using directive
@inject ApplicationDbContext DbContext // Inject the DbContext
@inject ILogger<Home> Logger // Inject Logger for error logging
@rendermode InteractiveServer // Ensure interactive mode for form handling

<PageTitle>Home</PageTitle>

<h1>Welcome to your new Bank Balance App.</h1>

<hr />

<h3>Enter Your Details</h3>

@if (!string.IsNullOrEmpty(statusMessage))
{
    <div class="alert @(isError ? "alert-danger" : "alert-success")" role="alert">
        @statusMessage
    </div>
}

<EditForm Model="userData" OnValidSubmit="HandleValidSubmit" FormName="userDataForm">
    <DataAnnotationsValidator />
    <ValidationSummary class="text-danger" role="alert" />

    <div class="mb-3">
        <label for="fullName" class="form-label">Full Name:</label>
        <InputText id="fullName" @bind-Value="userData.FullName" class="form-control" placeholder="Mikel Johnson" />
        <ValidationMessage For="() => userData.FullName" class="text-danger" />
    </div>

    <div class="mb-3">
        <label for="bankBalance" class="form-label">Bank Balance:</label>
        <InputNumber id="bankBalance" @bind-Value="userData.BankBalance" class="form-control" placeholder="500" />
        <ValidationMessage For="() => userData.BankBalance" class="text-danger" />
    </div>

    <button type="submit" class="btn btn-primary">Save Data</button>
</EditForm>

@code {
    private UserData userData = new();
    private string? statusMessage;
    private bool isError;

    private async Task HandleValidSubmit()
    {
        statusMessage = null; // Clear previous message
        isError = false;

        try
        {
            DbContext.UserDatas.Add(userData);
            await DbContext.SaveChangesAsync();
            statusMessage = "Data saved successfully.";
            userData = new(); // Reset form
            StateHasChanged(); // Update UI
        }
        catch (Exception ex)
        {
            Logger.LogError(ex, "Error saving user data.");
            statusMessage = "Error saving data. Please try again.";
            isError = true;
            StateHasChanged(); // Update UI
        }
    }
}